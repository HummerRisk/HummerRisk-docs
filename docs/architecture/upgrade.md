# 系统架构升级说明

## v1.0.0 版本之后单体架构版升级为微服务架构

!!! info "升级前的须知"
    1. HummerRisk v1.0.0 版本与 HummerRisk v0.10.0 以及之前版本存在一定的差异。
    2. HummerRisk v1.0.0 增加了一些新功能，也同时删除了一些功能，另外也对部分功能进行了重构和修复。

## 新版特性

!!! info "新版功能"
    - feat（架构升级）：HummerRisk 由 SpringBoot 单体架构升级为 SpringCloud 微服务架构，性能和效率显著提升。
    - feat（K8s 检测）：新增 K8s 类型检测规则组和规则，K8s 检测分为漏洞检测、配置检测、CIS Benchmarks 检测、合规规则检测。
    - feat（主机检测）：主机检测添加 sudo 权限，非 root 用户也可执行检测。
    - feat（多云检测）：新增阿里云 redis 规则。

!!! summary "优化功能"
    - refactor（定时任务）：定时任务优化，有日志可追踪。
    - refactor（多云检测）：优化新建云检测规则时校验功能。
    - refactor（资源概览）：优化云资源概览页面，云账号统计数据的展示。
    - refactor（操作审计）：优化操作审计页面部分字段的国际化翻译。
    - refactor（镜像仓库）：优化镜像仓库同步镜像，一键检测已同步镜像。
    - refactor（主机检测）：优化主机检测流程，优化主机密钥、主机管理。
    - refactor（K8s 检测）：优化 K8s 状态、trivy-operator、kubench 安装日志。
    - refactor（K8s 检测）：优化 K8s 检测，管理页面和检测结果页面合并。
    - refactor（部署检测）：优化部署检测，管理页面和检测结果页面合并。
    - refactor（镜像检测）：优化镜像检测，管理页面样式优化，并和检测结果页面合并。
    - refactor（源码检测）：优化源码检测，管理页面和检测结果页面合并。
    - refactor（文件检测）：优化文件检测，管理页面和检测结果页面合并。
    - refactor（多云检测）：云账号在编辑时不可查询 secret key 等私密凭证信息，只在添加时可见。
    - refactor（API）：优化 API Swagger 按模块微服务化。

!!! tip "删除功能"
    - fix（漏洞检测）：删除混合云安全中网络漏洞检测菜单。
    - fix（任务编排）：删除任务编排模块。
    - fix（首页分析）：删除首页分析菜单。
    - fix（定时检测）：删除云定时检测菜单。

!!! success "修复功能"
    - fix（对象存储）：修复对象存储账号中，执行一键检测，直接跳转到云账号检测结果页面的问题。
    - fix（镜像仓库）：修复镜像仓库用 IP + Port 的模式同步镜像，执行镜像检测时镜像地址错误的问题。
    - fix（SBOM 管理）：修复执行SBOM项目版本检测，未触发依赖文件的检测的问题。
    - fix（对象存储）：修复对象存储账号中，添加华为云对象存储失败的问题。
    - fix（主机管理）：修复 Excel 导入主机时名称为纯数字时报错的问题。
    - fix（主机管理）：修复添加主机绑定密钥文件失败的问题。
    - fix（镜像仓库）：修复 dockerhub 镜像仓库同步的镜像检测出错的问题。

## 架构对比

| 名称        |                  微服务架构                   |                        单机版架构                         |
|-----------|:----------------------------------------:|:----------------------------------------------------:|
| 前端技术栈     |                Vue 2.6.12                |                      Vue 2.6.12                      |
| 后端技术栈     |          Spring Cloud 2022.0.1           |                  Spring Boot 2.7.4                   |
| 桌面端组件库    |               Element 2.15               |                     Element 2.15                     |
| 数据库引擎     |                MySQL 8.0                 |                      MySQL 5.7                       |
| 其他组件      |     Redis 5.4、Nacos 2.2、xxl-job 2.4      |                          --                          |
| Java 运行环境 |                  JDK 17                  |                        JDK 11                        |
| 检测引擎      | Cloud Custodian、Prowler、Trivy、Kube-Bench | Cloud Custodian、Prowler、Trivy、Kube-Bench、Nuclei、Xray |


## 架构优势

!!! success "新版本架构优势"
    1. 系统被拆分成多个服务，粒度细，每个服务都是独立的业务单元，开发测试更容易。
    2. 各服务之间不互相依赖，可以独立部署。
    3. 每一个微服务专注于单一功能，并通过定义良好的接口清晰地表述服务边界，服务隔离，复杂度可控。
    4. 当架构中的某一组件发生故障时，故障不会在进程内扩散导致整个应用不可用，故障会被隔离在单个服务中。
    5. 单个服务应用也可以实现横向扩展，当应用的不同组件在扩展需求上存在差异时，每个服务可以根据实际需求独立进行扩展。
    6. 执行安全检测并发量提高，性能提高 100%，速度提高一倍。
    7. 更符合企业级软件应用的要求。
